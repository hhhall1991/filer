<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Newsroom Dashboard</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init({
              publicKey: "RbeVUo-zoi6r99uGH",
            });
        })();
    </script>

    <style>
        :root {
            --beige-bg: #f5f5dc;
            --paper: #fdfdf8;
            --accent: #d2b48c;
            --amber: #ffbf00;
            --text: #4a4a4a;
            --tab-inactive: #e9e9d0;
            --work-green: #c8e6c9;
            --work-text: #2e7d32;
            --off-red: #ffcccb;
            --off-text: #b71c1c;
            --post-it: #fff9c4;
            --sky-blue: #add8e6;
            --transition: all 0.2s ease-in-out;
        }

        /* --- NIGHT SHIFT MODE --- */
        body.dark-mode {
            --beige-bg: #121212;
            --paper: #1e1e1e;
            --text: #e0e0e0;
            --tab-inactive: #2d2d2d;
            --post-it: #444433;
            --accent: #a68b6a;
        }

        * { box-sizing: border-box; }
        body { 
            background-color: var(--beige-bg); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden;
            transition: background-color 0.4s ease, color 0.4s ease;
        }
        
        /* --- HEADER & TICKER --- */
        header { padding: 20px 40px; display: flex; align-items: center; gap: 40px; height: 80px; }
        .clock-container { flex-shrink: 0; border-bottom: 1px solid rgba(0, 0, 0, 0.2); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06); padding-bottom: 2px; }
        #clock { font-size: 2.8rem; font-weight: 200; color: #222; letter-spacing: -1px; white-space: nowrap; transition: color 0.4s ease; }
        body.dark-mode #clock { color: #fff; }

        .ticker-wrap { flex-grow: 1; overflow: hidden; background: rgba(255, 255, 255, 0.3); border-radius: 50px; padding: 12px 0; white-space: nowrap; display: flex; align-items: center; }
        .ticker { display: inline-block; animation: ticker 180s linear infinite; padding-left: 100%; }
        .ticker:hover { animation-play-state: paused; }
        .ticker-item { 
            display: inline-block; 
            padding: 0 30px; 
            font-size: 1rem; 
            color: #555; 
            text-decoration: none; 
            border-right: 1px solid rgba(0,0,0,0.1); 
            transition: color 0.4s ease;
        }
        body.dark-mode .ticker-item { color: #aaa; border-right-color: rgba(255,255,255,0.1); }
        
        .category-tag { font-weight: 900; color: #000; margin-right: 10px; padding: 2px 12px; border-radius: 4px; display: inline-flex; align-items: center; }
        .live-dot { height: 8px; width: 8px; background-color: #ff0000; border-radius: 50%; display: inline-block; margin-right: 8px; animation: blink 1s infinite; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* --- LAYOUT --- */
        main { display: grid; grid-template-columns: 1fr 340px; gap: 20px; padding: 0 40px 40px 40px; flex-grow: 1; height: calc(100% - 140px); overflow: hidden; }
        .card { 
            background: var(--paper); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            transition: var(--transition), background-color 0.4s ease;
            position: relative;
        }
        .sidebar-title { text-transform: uppercase; font-size: 0.75rem; font-weight: bold; letter-spacing: 1.5px; color: #a0a0a0; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }

        /* --- CALENDAR --- */
        #agenda-list { font-size: 0.8rem; max-height: 80px; overflow-y: auto; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
        .day-circle { width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; flex-direction: column; cursor: pointer; position: relative; transition: var(--transition); }
        .on-shift { background: var(--work-green); color: var(--work-text); }
        .off-shift { background: var(--off-red); color: var(--off-text); }
        
        .is-today { font-weight: 900; text-decoration: underline; }
        .selected-day { outline: 2px solid var(--amber); outline-offset: 2px; box-shadow: 0 0 8px rgba(255, 191, 0, 0.4); }

        .event-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 4px 0; border-bottom: 1px solid #f9f9f9; }
        .edit-event-btn { background: none; border: none; color: var(--accent); cursor: pointer; font-size: 1.1rem; }

        /* --- SEARCH --- */
        #search-results { max-height: 140px; overflow-y: auto; background: rgba(0,0,0,0.02); border-radius: 8px; margin-bottom: 10px; }
        .search-item { padding: 8px 10px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: var(--transition); }
        .search-item:hover { background: rgba(0,0,0,0.08); }
        .type-tag { font-size: 0.55rem; text-transform: uppercase; padding: 2px 6px; border-radius: 4px; font-weight: 800; color: #fff; flex-shrink: 0; }
        .tag-note { background: var(--accent); }
        .tag-archive { background: #7f8c8d; }
        .tag-event { background: var(--work-text); }
        .tag-task { background: #e67e22; }

        /* --- TO SORT LIST --- */
        .sort-item { background: var(--post-it); padding: 6px 10px; margin-bottom: 5px; border-radius: 4px; font-size: 0.75rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); transition: var(--transition); }
        .done-btn { background: #4CAF50; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; padding: 0; transition: var(--transition); }

        /* --- EDITOR --- */
        .editor-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .footer-buttons { display: flex; gap: 10px; }
        .file-btn, .email-btn, .night-btn { border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: var(--transition); }
        .file-btn { background: var(--accent); color: white; }
        .email-btn { background: #4a4a4a; color: white; }
        
        .night-btn { 
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent; 
            color: var(--accent); 
            border: 1px solid var(--accent); 
            font-size: 0.65rem; 
            padding: 4px 8px; 
            z-index: 10;
        }

        /* Bold & Larger Word Count */
        #word-count { font-size: 0.9rem; font-weight: bold; opacity: 0.7; }
        
        .tabs-wrapper { display: flex; align-items: center; gap: 5px; border-bottom: 1px solid #eee; overflow-x: auto; min-height: 40px; }
        .tab { background: var(--tab-inactive); padding: 10px 18px; border-radius: 10px 10px 0 0; cursor: pointer; font-size: 0.85rem; white-space: nowrap; transition: var(--transition); }
        .tab.active { background: var(--paper); font-weight: 600; }
        #catchline-input { border: none; outline: none; background: transparent; font-size: 1.4rem; font-weight: 700; border-bottom: 1px solid #f0f0f0; margin-bottom: 15px; font-family: inherit; width: 100%; color: var(--text); }
        #story-editor { width: 100%; height: 100%; border: none; outline: none; background: transparent; font-size: 1.2rem; line-height: 1.7; resize: none; font-family: inherit; color: var(--text); }
        
        .filed-item { font-size: 0.8rem; padding: 10px 8px; border-bottom: 1px solid #000; display: flex; justify-content: space-between; align-items: center; }
        .delete-note-btn { background: none; border: none; color: #ff4444; cursor: pointer; font-weight: bold; font-size: 0.9rem; }

        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; }
        .modal-content { background: var(--paper); padding: 20px; border-radius: 12px; width: 320px; color: var(--text); }
    </style>
</head>
<body id="main-body">

<form id="email-bridge-form" style="display:none;">
    <input type="hidden" name="title" id="hidden-title">
    <textarea name="message" id="hidden-message"></textarea>
    <input type="hidden" name="time" id="hidden-time">
</form>

<header>
    <div class="clock-container"><span id="clock">00:00:00</span></div>
    <div class="ticker-wrap"><div class="ticker" id="ticker-feed">Loading News...</div></div>
</header>

<main>
    <section class="card" style="padding-top: 10px;">
        <div class="tabs-wrapper" id="tab-bar"></div>
        <div class="editor-container" style="display:flex; flex-direction:column; height:100%; padding-top:15px;">
            <input type="text" id="catchline-input" placeholder="Catchline...">
            <textarea id="story-editor" placeholder="Start typing..."></textarea>
            <div class="editor-footer">
                <div id="word-count">WORDS: 0</div>
                <div class="footer-buttons">
                    <button class="email-btn" id="email-btn" onclick="fileAndEmail()">File & Email</button>
                    <button class="file-btn" onclick="fileNote()">File Story</button>
                </div>
            </div>
        </div>
    </section>

    <section class="card">
        <button class="night-btn" onclick="toggleDarkMode()">Night Shift</button>

        <div id="date-display" style="font-weight: bold; margin-bottom: 2px;">Date</div>
        <div id="greeting" style="font-size:0.85rem; opacity:0.7; margin-bottom:10px; font-style:italic;">Welcome, Thomas</div>
        
        <div class="sidebar-title">Tracker <button style="background:none;border:none;color:var(--accent);cursor:pointer;font-size:1.1rem" onclick="openEventModal()">+</button></div>
        <div class="calendar-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <button onclick="changeWeek(-1)" style="background:none;border:none;color:var(--accent);cursor:pointer;">❮</button>
            <div id="month-display">January 2026</div>
            <button onclick="changeWeek(1)" style="background:none;border:none;color:var(--accent);cursor:pointer;">❯</button>
        </div>
        <div id="week-calendar" class="week-grid" style="display:flex; justify-content:space-between; margin-bottom:12px;"></div>
        <div id="agenda-list"></div>

        <div class="sidebar-title">To Sort</div>
        <input type="text" id="sort-input" placeholder="Type & press Enter..." onkeydown="if(event.key==='Enter') addSortItem()" style="width:100%; padding:6px; border-radius:4px; border:1px solid #ddd; margin-bottom:8px; font-size:0.8rem; background:transparent; color:var(--text);">
        <div id="sort-list"></div>

        <div class="sidebar-title">Global Search</div>
        <input type="text" id="global-search-input" placeholder="Search everything..." oninput="runGlobalSearch()" style="width:100%; padding:8px 12px; border-radius:20px; border:1px solid #ddd; outline:none; font-size:0.8rem; margin-bottom:8px; background:transparent; color:var(--text);">
        <div id="search-results"></div>

        <button onclick="toggleFiled()" style="background:#eee; border:none; width:100%; text-align:left; padding:8px; border-radius:5px; font-size:0.75rem; font-weight:bold; cursor:pointer;">
            Filed Stories <span id="filed-count">(0)</span>
        </button>
        <div id="filed-list" style="display:none; padding-top:5px; max-height:100px; overflow-y:auto;"></div>
    </section>
</main>

<div id="eventModal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title" style="margin-top:0; font-size:1rem">Add Event</h3>
        <input type="date" id="event-date">
        <input type="time" id="event-time">
        <input type="text" id="event-location" placeholder="Location">
        <textarea id="event-details" placeholder="Details" rows="3"></textarea>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button onclick="closeEventModal()" style="background:none;border:none;color:var(--text);cursor:pointer;">Cancel</button>
            <button style="background:var(--accent); color:white; border:none; padding:6px 15px; border-radius:4px; cursor:pointer;" onclick="saveEvent()">Save</button>
        </div>
    </div>
</div>

<script>
    // --- SHIFT DATA ---
    const workedWeekends = [{month:0,days:[4],type:'sun'},{month:0,days:[17,18],type:'both'},{month:1,days:[1],type:'sun'},{month:1,days:[14,15],type:'both'},{month:2,days:[1],type:'sun'},{month:2,days:[14,15],type:'both'},{month:2,days:[29],type:'sun'},{month:3,days:[11,12],type:'both'},{month:3,days:[26],type:'sun'},{month:4,days:[9,10],type:'both'},{month:4,days:[24],type:'sun'},{month:5,days:[6,7],type:'both'},{month:5,days:[21],type:'sun'},{month:6,days:[4,5],type:'both'},{month:6,days:[19],type:'sun'},{month:7,days:[1,2],type:'both'},{month:7,days:[16],type:'sun'},{month:7,days:[29,30],type:'both'},{month:8,days:[13],type:'sun'},{month:8,days:[26,27],type:'both'},{month:9,days:[11],type:'sun'},{month:9,days:[24,25],type:'both'},{month:10,days:[8],type:'sun'},{month:10,days:[21,22],type:'both'},{month:11,days:[6],type:'sun'},{month:11,days:[19,20],type:'both'}];
    
    let currentWeekStart = new Date(); const todayObj = new Date();
    const offset = todayObj.getDay() === 0 ? 6 : todayObj.getDay() - 1;
    currentWeekStart.setDate(todayObj.getDate() - offset); currentWeekStart.setHours(0,0,0,0);
    
    let selectedDate = new Date(); selectedDate.setHours(0,0,0,0);
    let events = JSON.parse(localStorage.getItem('newsroom-events-final')) || [];
    let sortItems = JSON.parse(localStorage.getItem('newsroom-sort-final')) || [];
    let notes = JSON.parse(localStorage.getItem('newsroom-notes-final')) || [{id:Date.now(), title:'', content:'', filed:false}];
    let activeId = notes.find(n => !n.filed)?.id || notes[0].id;

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('newsroom-darkmode', document.body.classList.contains('dark-mode'));
    }
    if (localStorage.getItem('newsroom-darkmode') === 'true') document.body.classList.add('dark-mode');

    function updateWordCount() {
        const text = document.getElementById('story-editor').value;
        const count = text.trim() ? text.trim().split(/\s+/).length : 0;
        document.getElementById('word-count').innerText = `WORDS: ${count}`;
    }

    function runGlobalSearch() {
        const term = document.getElementById('global-search-input').value.toLowerCase();
        const resBox = document.getElementById('search-results');
        if(!term) { resBox.innerHTML = ""; return; }
        let html = "";
        notes.forEach(n => { if(n.title.toLowerCase().includes(term) || n.content.toLowerCase().includes(term)) html += `<div class="search-item" onclick="openFoundNote(${n.id})"><span class="type-tag ${n.filed?'tag-archive':'tag-note'}">${n.filed?'Archive':'Note'}</span><span>${n.title || 'Untitled'}</span></div>`; });
        events.forEach(e => { if(e.details.toLowerCase().includes(term) || (e.location && e.location.toLowerCase().includes(term))) html += `<div class="search-item" onclick="selectDay('${new Date(e.date).toISOString()}')"><span class="type-tag tag-event">Event</span><span>${e.details}</span></div>`; });
        sortItems.forEach(s => { if(s.toLowerCase().includes(term)) html += `<div class="search-item"><span class="type-tag tag-task">Task</span><span>${s}</span></div>`; });
        resBox.innerHTML = html || "<div style='padding:8px; opacity:0.5; font-size:0.75rem'>No matches.</div>";
    }

    function fileAndEmail() {
        const n = notes.find(x => x.id === activeId); if(!n) return;
        const btn = document.getElementById('email-btn'); btn.disabled = true; btn.innerText = "Sending...";
        document.getElementById('hidden-title').value = n.title || "Untitled Story";
        document.getElementById('hidden-message').value = n.content || "(No content)";
        document.getElementById('hidden-time').value = new Date().toLocaleString();
        emailjs.sendForm('service_i7fjjgg', 'template_591ycw8', document.getElementById('email-bridge-form'))
            .then(() => { btn.innerText = "Sent!"; setTimeout(() => { fileNote(); btn.disabled = false; btn.innerText = "File & Email"; }, 1000); }, 
                  (err) => { alert("Failed to send."); btn.disabled = false; btn.innerText = "File & Email"; });
    }

    function isWorkDay(t) {
        const d = new Date(t); d.setHours(0,0,0,0); const day = d.getDay();
        const check = (x) => workedWeekends.find(s => s.month === x.getMonth() && s.days.includes(x.getDate()));
        if(day===0||day===6) return !!check(d);
        if(day===1||day===2){ const ls = new Date(d); ls.setDate(d.getDate()-(day===1?2:3)); if(check(ls)) return false; }
        if(day===5){ const lu = new Date(d); lu.setDate(d.getDate()-5); const s = check(lu); if(s&&s.type==='sun') return false; }
        return true;
    }

    function renderWeek() {
        document.getElementById('month-display').innerText = currentWeekStart.toLocaleDateString([], {month:'long', year:'numeric'});
        let html = ""; const names = ['M','T','W','T','F','S','S'];
        for(let i=0; i<7; i++){
            const d = new Date(currentWeekStart); d.setDate(currentWeekStart.getDate() + i);
            const w = isWorkDay(d); const isToday = d.toDateString() === todayObj.toDateString();
            const isSel = d.toDateString() === selectedDate.toDateString();
            html += `<div class="day-circle ${w?'on-shift':'off-shift'} ${isToday?'is-today':''} ${isSel?'selected-day':''}" onclick="selectDay('${d.toISOString()}')"><span style="font-size:0.55rem;opacity:0.6">${names[i]}</span>${d.getDate()}</div>`;
        }
        document.getElementById('week-calendar').innerHTML = html;
        renderAgenda();
    }

    function selectDay(s) { selectedDate = new Date(s); renderWeek(); }
    function changeWeek(dir) { currentWeekStart.setDate(currentWeekStart.getDate() + (dir * 7)); renderWeek(); }

    function renderAgenda() {
        const dayEvents = events.filter(e => new Date(e.date).toDateString() === selectedDate.toDateString());
        const list = document.getElementById('agenda-list');
        if(dayEvents.length===0) list.innerHTML = `<div style="opacity:0.4; font-size:0.75rem">No events.</div>`;
        else list.innerHTML = dayEvents.sort((a,b)=>a.time.localeCompare(b.time)).map(e => `
            <div class="event-item"><div class="event-info"><div style="font-size:0.7rem; color:#888;">${e.time} ${e.location ? ' - <strong>'+e.location+'</strong>' : ''}</div><div>${e.details}</div></div><button class="edit-event-btn" onclick="editEvent('${e.id}')">···</button></div>`).join('');
    }

    function renderTabs() { 
        const active = notes.filter(n => !n.filed);
        document.getElementById('tab-bar').innerHTML = active.map(n => `<div class="tab ${n.id === activeId ? 'active' : ''}" onclick="switchNote(${n.id})">${n.title || 'Catchline'}</div>`).join('') + '<button onclick="createNewNote()" style="background:none;border:none;color:var(--accent);cursor:pointer;font-size:1.5rem;padding:0 10px;">+</button>';
        const filed = notes.filter(n => n.filed); document.getElementById('filed-count').innerText = `(${filed.length})`;
        document.getElementById('filed-list').innerHTML = filed.map(n => `<div class="filed-item"><span onclick="unfileNote(${n.id})" style="flex-grow:1;cursor:pointer;">${n.title || 'Untitled'}</span><button class="delete-note-btn" onclick="deleteNote(${n.id})">✕</button></div>`).join('');
    }

    function createNewNote() { const n={id:Date.now(), title:'', content:'', filed:false}; notes.push(n); activeId=n.id; save(); }
    function switchNote(id) { activeId=id; save(); }
    function fileNote() { const n=notes.find(x=>x.id===activeId); if(n){ n.filed=true; const next=notes.find(x=>!x.filed); activeId = next ? next.id : null; if(!activeId) createNewNote(); save(); } }
    function unfileNote(id) { const n=notes.find(x=>x.id===id); if(n){n.filed=false; activeId=id; save(); } }
    function deleteNote(id) { if(confirm('Delete permanently?')) { notes = notes.filter(n => n.id !== id); save(); } }
    function toggleFiled() { const l=document.getElementById('filed-list'); l.style.display = l.style.display==='block'?'none':'block'; }
    function save() { 
        localStorage.setItem('newsroom-notes-final', JSON.stringify(notes)); 
        const a = notes.find(n => n.id === activeId); 
        document.getElementById('story-editor').value = a?.content || ""; 
        document.getElementById('catchline-input').value = a?.title || ""; 
        renderTabs(); 
        updateWordCount();
    }
    function openFoundNote(id) { const note = notes.find(n => n.id === id); if(note.filed) note.filed = false; activeId = id; save(); document.getElementById('global-search-input').value = ""; document.getElementById('search-results').innerHTML = ""; }

    function addSortItem() { const i=document.getElementById('sort-input'); if(i.value){ sortItems.push(i.value); i.value=""; localStorage.setItem('newsroom-sort-final', JSON.stringify(sortItems)); renderSort(); }}
    function renderSort() { document.getElementById('sort-list').innerHTML = sortItems.map((s,idx) => `<div class="sort-item"><span>${s}</span><button class="done-btn" onclick="removeSort(${idx})">✓</button></div>`).join(''); }
    function removeSort(idx) { sortItems.splice(idx,1); localStorage.setItem('newsroom-sort-final', JSON.stringify(sortItems)); renderSort(); }

    function openEventModal() { editingEventId = null; document.getElementById('eventModal').style.display='flex'; }
    function editEvent(id) { const ev = events.find(e => e.id === id); if(!ev) return; editingEventId = id; document.getElementById('event-date').value = ev.date; document.getElementById('event-time').value = ev.time; document.getElementById('event-location').value = ev.location; document.getElementById('event-details').value = ev.details; document.getElementById('eventModal').style.display='flex'; }
    function closeEventModal() { document.getElementById('eventModal').style.display='none'; }
    function saveEvent() { const d = document.getElementById('event-date').value, t = document.getElementById('event-time').value, l = document.getElementById('event-location').value, det = document.getElementById('event-details').value; if(d && t && det) { if(editingEventId) { const i = events.findIndex(e => e.id === editingEventId); events[i] = {id:editingEventId, date:d, time:t, location:l, details:det}; } else { events.push({id:Date.now().toString(), date:d, time:t, location:l, details:det}); } localStorage.setItem('newsroom-events-final', JSON.stringify(events)); closeEventModal(); renderWeek(); } }

    async function getFeeds() {
        const fetchFeed = async (url) => { try { const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`); const data = await res.json(); return data.items || []; } catch(e) { return []; } };
        const bbcNews = await fetchFeed('https://feeds.bbci.co.uk/news/rss.xml?edition=uk');
        const bbcSport = await fetchFeed('https://feeds.bbci.co.uk/sport/rss.xml');
        const skyNews = await fetchFeed('https://feeds.skynews.com/feeds/rss/home.xml');
        const ticker = document.getElementById('ticker-feed');
        
        const live = '<span class="live-dot"></span>LIVE';
        let html = `<span class="category-tag tag-news" style="background:#ffcccb;">${live} BBC NEWS</span>` + bbcNews.map(item => `<a href="${item.link}" target="_blank" class="ticker-item">${item.title}</a>`).join('');
        html += `<span class="category-tag tag-sport" style="background:#fff9c4; margin-left:100px;">BBC SPORT</span>` + bbcSport.map(item => `<a href="${item.link}" target="_blank" class="ticker-item">${item.title}</a>`).join('');
        html += `<span class="category-tag tag-sky" style="background:var(--sky-blue); margin-left:100px;">${live} SKY NEWS</span>` + skyNews.map(item => `<a href="${item.link}" target="_blank" class="ticker-item">${item.title}</a>`).join('');
        ticker.innerHTML = html;
    }

    document.getElementById('catchline-input').addEventListener('input', e => { const n=notes.find(x=>x.id===activeId); if(n){ n.title=e.target.value; renderTabs(); localStorage.setItem('newsroom-notes-final', JSON.stringify(notes)); }});
    document.getElementById('story-editor').addEventListener('input', e => { 
        const n=notes.find(x=>x.id===activeId); 
        if(n){ n.content=e.target.value; localStorage.setItem('newsroom-notes-final', JSON.stringify(notes)); }
        updateWordCount();
    });

    function updateTime() {
        const n = new Date(); document.getElementById('clock').innerText = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0')+":"+n.getSeconds().toString().padStart(2,'0');
        document.getElementById('date-display').innerText = n.toLocaleDateString([], {weekday:'long', month:'long', day:'numeric'});
        let h=n.getHours(), m="Good Evening, Thomas"; if(h<12) m="Good Morning, Thomas"; else if(h<17) m="Good Afternoon, Thomas";
        document.getElementById('greeting').innerText = m; renderWeek();
    }

    setInterval(updateTime, 1000); updateTime(); getFeeds(); setInterval(getFeeds, 600000); renderSort(); save();
</script>
</body>
</html>